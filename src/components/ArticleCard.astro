---
import { getLang, localizedUrl, t, getDateLocale } from '@/utils/i18n';

export interface Props {
  title: string;
  description: string;
  date: Date | string;
  category: string;
  slug: string;
  featured?: boolean;
}

const {
  title,
  description,
  date,
  category,
  slug,
  featured = false,
} = Astro.props;

const lang = getLang(Astro.url);
const categorySlug = category.toLowerCase().replace(/\s+/g, '-').normalize('NFD').replace(/[\u0300-\u036f]/g, '');

function parseDate(val: Date | string): Date {
  if (val instanceof Date && !isNaN(val.getTime())) return val;
  const d = new Date(String(val));
  return isNaN(d.getTime()) ? new Date() : d;
}

const safeDate = parseDate(date);
const formattedDate = safeDate.toLocaleDateString(getDateLocale(lang), {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<article class:list={['card', { 'card--featured': featured }]}>
  <a href={localizedUrl(`/blog/${slug}/`, lang)} class="card__link">
    <div class="card__header">
      <span class="card__category">{category}</span>
      <div class="card__header-decoration"></div>
    </div>

    <div class="card__content">
      <div class="card__meta">
        <span class="tag">{category}</span>
        <time datetime={safeDate.toISOString()}>{formattedDate}</time>
      </div>

      <h3 class="card__title">{title}</h3>
      <p class="card__description">{description}</p>

      <span class="card__read-more">
        {t(lang, 'readArticle')}
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
          <path d="M3 8h10M9 4l4 4-4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </span>
    </div>
  </a>
</article>

<style>
  .card {
    border-radius: var(--border-radius-lg);
    overflow: hidden;
    background: var(--color-white);
    border: 1px solid var(--color-gray-100);
    transition: all var(--transition-base);
  }

  .card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-xl);
    border-color: transparent;
  }

  .card__link {
    display: block;
    text-decoration: none;
    color: inherit;
  }

  .card__header {
    position: relative;
    padding: var(--spacing-xl) var(--spacing-lg) var(--spacing-lg);
    background: var(--gradient-primary);
    overflow: hidden;
  }

  .card__header-decoration {
    position: absolute;
    top: -30%;
    right: -10%;
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
  }

  .card__header-decoration::after {
    content: '';
    position: absolute;
    bottom: -60%;
    left: -40%;
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.08);
  }

  .card__category {
    position: relative;
    z-index: 1;
    font-size: var(--font-size-sm);
    font-weight: 700;
    color: var(--color-white);
    text-transform: uppercase;
    letter-spacing: 0.06em;
  }

  .card__content {
    padding: var(--spacing-lg);
  }

  .card__meta {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-md);
    font-size: var(--font-size-xs);
    color: var(--color-gray-400);
  }

  .card__title {
    font-size: var(--font-size-xl);
    font-weight: 700;
    line-height: 1.3;
    margin-bottom: var(--spacing-sm);
    color: var(--color-gray-900);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .card__description {
    font-size: var(--font-size-sm);
    color: var(--color-gray-500);
    line-height: 1.6;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    margin-bottom: var(--spacing-md);
  }

  .card__read-more {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-xs);
    font-size: var(--font-size-sm);
    font-weight: 600;
    color: var(--color-primary);
    transition: gap var(--transition-base);
  }

  .card:hover .card__read-more {
    gap: var(--spacing-sm);
  }

  /* Featured variant */
  .card--featured {
    grid-column: 1 / -1;
  }

  .card--featured .card__header {
    padding: var(--spacing-3xl) var(--spacing-2xl);
    min-height: 160px;
    display: flex;
    align-items: flex-end;
  }

  .card--featured .card__category {
    font-size: var(--font-size-lg);
  }

  .card--featured .card__header-decoration {
    width: 200px;
    height: 200px;
    top: -40%;
    right: -5%;
  }

  .card--featured .card__header-decoration::after {
    width: 120px;
    height: 120px;
  }

  .card--featured .card__content {
    padding: var(--spacing-xl) var(--spacing-2xl) var(--spacing-2xl);
  }

  .card--featured .card__title {
    font-size: var(--font-size-2xl);
    -webkit-line-clamp: 3;
  }

  .card--featured .card__description {
    font-size: var(--font-size-base);
    -webkit-line-clamp: 4;
  }

  @media (max-width: 768px) {
    .card--featured .card__header {
      min-height: 120px;
      padding: var(--spacing-2xl) var(--spacing-lg);
    }

    .card--featured .card__content {
      padding: var(--spacing-lg);
    }

    .card--featured .card__title {
      font-size: var(--font-size-xl);
    }
  }
</style>
